- alias: "Brandlarmet notis"
  trigger:
    - platform: event
      event_type: signal_received
      event_data: {"entity_id": "sensor.brandvarnare_2_sensor_status"}
  action:
    - service: notify.html5
      data:
        message: 'Brandlarmet utlöst!'
    - service: notify.pushover
      data:
        message: 'Brandlarmet utlöst!'
    - service: notify.telegram
      data:
        message: "Verkar som brandlarmet har utlösts klockan {{ now().strftime('%H:%M') }}!"

- alias: "Ny enhet hittad notis"
  trigger:
    platform: event
    event_type: device_tracker_new_device
  action:
    - service: notify.telegram
      data_template:
        target: !secret telegram_par_chat_id
        message: "Ny enhet spåras: {{ trigger.event.data }}"

- alias: "Enhet offline"
  trigger:
    platform: state
    entity_id: sensor.kamera_kallare
    to: 'Offline'
  action:
    - service: notify.telegram
      data:
        target: !secret telegram_par_chat_id
        title: 'Varning'
        message: "Kameran i källaren är offline"

- alias: 'Batteristatus på netatmo'
  trigger:
    platform: state
    entity_id: sensor.netatmo_vardagsrummet_battery, sensor.netatmo_badrum_kallare_battery, sensor.netatmo_utomhus_battery, sensor.netatmo_regnmatare_battery
    to: 'Low'
  action:
    - service: notify.telegram
      data_template:
        target: !secret telegram_par_chat_id
        title: 'Varning'
        message: 'Sensor {{ trigger.to_state.attributes.friendly_name }} har lågt batteri'

- alias: 'Baksida dörr öppen'
  trigger:
    - platform: state
      entity_id: group.family
      to: 'not_home'
    - platform: state
      entity_id: input_boolean.vacation_mode
      to: 'on'
    - platform: state
      entity_id: input_boolean.all_asleep
      to: 'on'
  condition:
    - condition: state
      entity_id: binary_sensor.baksidadorr_sensor
      state: 'on'
  action:
    - service: notify.telegram
      data_template:
        target: !secret telegram_par_chat_id
        title: 'Varning'
        message: 'Baksida dörr fortfarande öppen'

- alias: 'Lampa offline'
  trigger:
    platform: state
    entity_id: light.lampa_ytterdorren
    to: 'unavailable'
    for:
      minutes: 10
  action:
    - service: notify.telegram
      data_template:
        target: !secret telegram_par_chat_id
        title: 'Varning'
        message: "{{ trigger.to_state.attributes.friendly_name }} är otillgänglig. Någon kanske trycke på knappen?"

- alias: 'God morgon'
  trigger:
    platform: state
    entity_id: input_boolean.all_asleep
    to: 'off'
  action:
    - service: notify.telegram
      data:
        title: 'God morgon!'
        message: |
          Ännu en härlig dag att se fram emot.
          Prognos just nu:
          {{ states.weather.smhi_home.state }}
          Förväntad mängd regn:
          {{ states.weather.smhi_home.attributes.forecast[0].precipitation }} mm
          Förväntad lägsta temperatur idag:
          {{ states.weather.smhi_home.attributes.forecast[0].templow }} grader
          Temperaturen just nu:  {{ states.sensor.netatmo_utomhus_temperature.state_with_unit }}
          {% if states.sensor.netatmo_regnmatare_sum_rain_24.state|float > 0 %}
          Det har regnat {{ states.sensor.netatmo_regnmatare_sum_rain_24.state_with_unit }} sedan midnatt
          {% endif %}
    - service: switch.turn_on
      entity_id: switch.ikea_switch_2

- alias: "Tvätten klar"
  trigger:
    platform: state
    entity_id: binary_sensor.washing_machine
    to: 'off'
  action:
    - service: telegram_bot.send_message
      data_template:
        message: "tvätten är klar!"
        inline_keyboard:
          - "Påminn mig senare:/washing_reminder"

- alias: "Tvätten är fortfarande kvar"
  trigger:
    platform: numeric_state
    entity_id: sensor.washing_machine_switch_power
    above: 0
    below: 5
    for:
      minutes: 30
  condition:
    - condition: state
      entity_id: binary_sensor.washing_machine
      state: "off"
  action:
    - service: notify.telegram
      data:
        message: "Tvätten är fortfarande klar. Om den är urplockad har ni glömt stänga av maskinen"

- alias: 'Väg dig påminnelse'
  trigger:
    platform: state
    entity_id: input_boolean.all_asleep
    to: 'off'
    for:
      minutes: 10
  condition:
    - condition: state
      entity_id: device_tracker.par_telefon
      state: "home"
  action:
    - service: notify.telegram
      data_template:
        target: !secret telegram_par_chat_id
        message: Glöm inte väga dig.